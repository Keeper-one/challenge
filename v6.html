<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠ Ø­Ø±Ø§Ø³ Ø§Ù„Ù…Ø±Ù…Ù‰ - ÙƒÙŠØ¨Ø± ÙˆÙ†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
            overscroll-behavior: none;
        }
        .page { display: none; }
        .page.active { display: flex; }
        .btn-game {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .btn-game:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.4);
        }
        .color-btn-game1 {
            transition: transform 0.1s ease;
            width: 70px;
            height: 70px;
            border: 4px solid white;
        }
        .color-btn-game1:active {
            transform: scale(0.9);
        }
        .feedback-animation {
            animation: feedback-pop 0.5s ease-out forwards;
        }
        @keyframes feedback-pop {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0; transform: translateY(-50px); }
        }
        #game2-shape-container {
            perspective: 1000px;
        }
        .shape {
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .shape:hover {
            transform: scale(1.1) rotate(5deg);
        }
        #game3-timer-bar-inner {
            transition: width 0.1s linear;
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.7);
        }
        #leaderboard-filters .filter-btn {
            background-color: #4a5568; color: #e2e8f0; padding: 8px 16px; border-radius: 8px; transition: all 0.2s ease;
        }
        #leaderboard-filters .filter-btn:hover { background-color: #718096; }
        #leaderboard-filters .filter-btn.active { background-color: #f6e05e; color: #1a202c; font-weight: bold; }
        .bg-whatsapp-green { background-color: #25D366; }
        .bg-whatsapp-green:hover { background-color: #128C7E; }
    </style>
</head>
<body class="antialiased">

    <div id="app-container" class="min-h-screen flex flex-col items-center justify-center p-4">

        <div id="page-menu" class="page active flex-col items-center justify-center w-full max-w-2xl text-center">
            <h1 class="text-6xl font-black text-white mb-2">K1</h1>
            <h2 class="text-2xl font-bold text-yellow-400 mb-1 tracking-widest">keeper one Challenge</h2>
            <p class="text-xl text-gray-300 mb-8">ØªØ­Ø¯ÙŠ Ø§Ù„Ø­Ø±Ø§Ø³ Ù…Ù† ÙƒÙŠØ¨Ø± ÙˆÙ†</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full">
                <button onclick="app.prepareGame('game1')" class="btn-game bg-blue-600 p-4 rounded-lg text-xl font-bold">1. ØªØ­Ø¯ÙŠ Ø±Ø¯Ø© Ø§Ù„ÙØ¹Ù„</button>
                <button onclick="app.prepareGame('game2')" class="btn-game bg-green-600 p-4 rounded-lg text-xl font-bold">2. ØªØ­Ø¯ÙŠ Ø§Ù„Ø£ÙƒØ¨Ø± ÙˆØ§Ù„Ø£ØµØºØ±</button>
                <button onclick="app.prepareGame('game3')" class="btn-game bg-purple-600 p-4 rounded-lg text-xl font-bold">3. Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ</button>
                <button onclick="app.prepareGame('game4')" class="btn-game bg-red-600 p-4 rounded-lg text-xl font-bold">4. ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ§Ù„Ù„ÙˆÙ†</button>
                <button onclick="app.prepareGame('game5')" class="btn-game bg-pink-600 p-4 rounded-lg text-xl font-bold">5. ØªØ­Ø¯ÙŠ Ø§Ù„Ø­Ø§Ø±Ø³ÙŠÙ†</button>
            </div>
             <div class="mt-8 w-full flex flex-col items-center space-y-4">
                <button onclick="app.showPage('page-leaderboard-menu')" class="bg-yellow-400 text-gray-900 w-full md:w-1/2 p-4 rounded-lg text-2xl font-black">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ ğŸ†</button>
                <button onclick="app.showPage('page-instructions')" class="bg-gray-700 text-white w-full md:w-1/2 p-3 rounded-lg text-xl font-bold">ğŸ“œ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</button>
            </div>
             <div class="mt-8 w-full border-t border-gray-700 pt-6">
                <p class="text-lg font-bold mb-4">Ù…ØªØ¬Ø± ÙˆØ­Ø³Ø§Ø¨Ø§Øª ÙƒÙŠØ¨Ø± ÙˆÙ†</p>
                <a href="https://Keeper-1.com" target="_blank" class="block bg-green-500 text-white w-full md:w-1/2 mx-auto p-3 rounded-lg text-lg font-bold mb-4">ğŸ›’ Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±</a>
                <div class="flex justify-center space-x-6">
                     <a href="https://www.instagram.com/keeper1gk" target="_blank" class="text-gray-400 hover:text-white transition text-3xl">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427C2.013 14.784 2 14.43 2 12s.013-2.784.06-3.808c.049-1.064.218-1.791.465-2.427A4.902 4.902 0 013.68 4.465a4.902 4.902 0 011.772-1.153C6.088 3.065 6.815 2.896 7.88 2.847 8.904 2.013 9.258 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.06-1.004.048-1.625.2-2.124.385-.583.21-.96.48-1.38.9-.42.42-.69.8-.9 1.38-.185.5-.337 1.12-.385 2.124-.049 1.023-.06 1.351-.06 3.807s.011 2.784.06 3.808c.048 1.003.2 1.624.385 2.124.21.583.48.96.9 1.38.42.42.8.69 1.38.9.5.185 1.12.337 2.124.385 1.023.049 1.351.06 3.807.06h.468c2.456 0 2.784-.011 3.808-.06 1.003-.048 1.624-.2 2.124-.385.583-.21.96.48 1.38-.9.42-.42.69-.8.9-1.38.185-.5.337-1.12.385-2.124.049-1.024.06-1.351.06-3.808s-.011-2.784-.06-3.808c-.048-1.003-.2-1.624-.385-2.124a3.102 3.102 0 00-.9-1.38 3.102 3.102 0 00-1.38-.9c-.5-.185-1.12-.337-2.124-.385C15.18 3.813 14.852 3.802 12.4 3.802zM12 8.25a3.75 3.75 0 100 7.5 3.75 3.75 0 000-7.5zM12 14a2 2 0 110-4 2 2 0 010 4zm6.406-7.126a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd" /></svg>
                     </a>
                     <a href="https://www.snapchat.com/add/keeper1gk" target="_blank" class="text-gray-400 hover:text-white transition text-3xl">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M11.91 2.374c-4.321 0-7.822 3.5-7.822 7.822 0 1.944.71 3.71 1.889 5.093a.382.382 0 00.279.133h.013c.108 0 .21-.05.273-.139l.295-.41c.36-.502.834-.903 1.39-1.183.18-.09.387-.14.593-.14.414 0 .81.163 1.11.455.326.319.742.493 1.17.493s.844-.174 1.17-.493c.3-.292.696-.455 1.11-.455.207 0 .413.05.593.14.557.28 1.031.681 1.39 1.183l.295.41c.063.088.165.139.273.139h.013c.105 0 .204-.04.28-.133 1.178-1.382 1.888-3.148 1.888-5.093 0-4.322-3.501-7.822-7.821-7.822zm-8.736 9.176c-.666 0-1.206.54-1.206 1.206s.54 1.206 1.206 1.206 1.206-.54 1.206-1.206-.54-1.206-1.206-1.206zm16.279 0c-.666 0-1.206.54-1.206 1.206s.54 1.206 1.206 1.206 1.206-.54 1.206-1.206-.54-1.206-1.206-1.206z" /></svg>
                     </a>
                </div>
            </div>
        </div>

        <div id="page-user-info" class="page flex-col items-center justify-center w-full max-w-sm text-center">
             <h2 class="text-3xl font-bold mb-6">ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ù„</h2>
             <input type="text" id="player-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ø±Ø³" class="w-full p-3 mb-4 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-400">
             <input type="tel" id="player-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ù…Ø«Ø§Ù„: 05xxxxxxx)" class="w-full p-3 mb-6 bg-gray-700 rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-400">
             <button onclick="app.startGame()" class="bg-green-500 w-full p-4 rounded-lg text-2xl font-black">ğŸ”¥ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ ğŸ”¥</button>
             <button onclick="app.returnToMenu()" class="mt-4 text-gray-400">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
        </div>

        <div id="page-game1" class="page flex-col items-center justify-center w-full max-w-2xl text-center relative">
            <div id="game1-feedback" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-5xl font-black text-white pointer-events-none"></div>
            <h2 class="text-4xl font-black mb-4">ØªØ­Ø¯ÙŠ Ø±Ø¯Ø© Ø§Ù„ÙØ¹Ù„ âš¡</h2>
            <p id="game1-round" class="text-2xl mb-2"></p>
            <p class="text-xl text-gray-400 mb-6">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„ÙˆÙ† Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹ (Ù„Ø¯ÙŠÙƒ 10 Ø«ÙˆØ§Ù†ÙŠ)!</p>
            <div id="game1-target-color" class="w-40 h-40 rounded-lg mb-8 mx-auto border-4 border-gray-600 flex items-center justify-center">
                <p id="game1-wait-msg" class="text-2xl font-bold animate-pulse">Ø§Ø³ØªØ¹Ø¯...</p>
            </div>
            <div id="game1-buttons" class="grid grid-cols-4 gap-3 justify-center">
                <button onclick="app.games.game1.checkAnswer('red')" class="color-btn-game1 rounded-full bg-red-600"></button>
                <button onclick="app.games.game1.checkAnswer('green')" class="color-btn-game1 rounded-full bg-green-600"></button>
                <button onclick="app.games.game1.checkAnswer('blue')" class="color-btn-game1 rounded-full bg-blue-600"></button>
                <button onclick="app.games.game1.checkAnswer('yellow')" class="color-btn-game1 rounded-full bg-yellow-400"></button>
                <button onclick="app.games.game1.checkAnswer('purple')" class="color-btn-game1 rounded-full bg-purple-600"></button>
                <button onclick="app.games.game1.checkAnswer('cyan')" class="color-btn-game1 rounded-full bg-cyan-500"></button>
                <button onclick="app.games.game1.checkAnswer('white')" class="color-btn-game1 rounded-full bg-white"></button>
                <button onclick="app.games.game1.checkAnswer('black')" class="color-btn-game1 rounded-full bg-black"></button>
            </div>
            <div id="game1-results-table" class="mt-8 w-full max-w-md"></div>
             <button onclick="app.returnToMenu()" class="mt-8 text-gray-400">Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>

        <div id="page-game2" class="page flex-col items-center justify-center w-full max-w-4xl text-center">
            <div class="w-full flex justify-between items-center mb-4">
                <div id="game2-timer" class="text-2xl font-bold bg-red-600 px-4 py-2 rounded-lg">30</div>
                <h2 class="text-4xl font-black">ØªØ­Ø¯ÙŠ Ø§Ù„Ø£ÙƒØ¨Ø± ÙˆØ§Ù„Ø£ØµØºØ±</h2>
                <div class="text-right">
                    <p class="text-lg text-gray-400">Ø§Ù„Ù†ØªÙŠØ¬Ø©</p>
                    <p id="game2-score" class="text-2xl font-bold text-yellow-400">0</p>
                </div>
            </div>
            <p id="game2-instruction" class="text-3xl font-bold my-6 p-3 bg-gray-700 rounded-lg"></p>
            <div id="game2-shape-container" class="grid grid-cols-3 md:grid-cols-3 gap-4 w-full h-80 place-items-center"></div>
            <button onclick="app.returnToMenu()" class="mt-8 text-gray-400">Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>

        <div id="page-game3" class="page flex-col items-center justify-center w-full max-w-2xl text-center">
            <h2 class="text-4xl font-black mb-2">Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ â±ï¸</h2>
            <p id="game3-round" class="text-2xl mb-4"></p>
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg w-full">
                <p class="text-xl text-gray-400">Ø£ÙˆÙ‚Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø«Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø¨Ø§Ù„Ø¶Ø¨Ø·!</p>
                <p class="text-6xl font-black my-4 text-yellow-400" id="game3-target-time">5.00</p>
                <div id="game3-timer-display" class="text-8xl font-mono font-black my-6 text-white">0.00</div>
                <div id="game3-timer-bar" class="w-full h-4 bg-gray-600 rounded-full mb-6 overflow-hidden">
                    <div id="game3-timer-bar-inner" class="h-full bg-green-500"></div>
                </div>
                <button id="game3-action-btn" class="w-full p-4 text-3xl font-black rounded-lg transition"></button>
            </div>
            <div id="game3-results-table" class="mt-6 w-full max-w-md"></div>
            <button onclick="app.returnToMenu()" class="mt-6 text-gray-400">Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>
        
        <div id="page-game4" class="page flex-col items-center justify-center w-full max-w-3xl text-center">
             <div class="w-full flex justify-between items-center mb-4">
                <p id="game4-round" class="text-2xl font-bold">Ø§Ù„Ø¬ÙˆÙ„Ø© 1 / 10</p>
                <h2 class="text-4xl font-black">ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ§Ù„Ù„ÙˆÙ† ğŸ§ </h2>
                <div class="text-right">
                    <p class="text-lg text-gray-400">Ø§Ù„Ù†Ù‚Ø§Ø·</p>
                    <p id="game4-score" class="text-2xl font-bold text-yellow-400">0</p>
                </div>
            </div>
            <p class="text-xl text-gray-400 mb-6">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ù„Ø°ÙŠ ÙŠØ·Ø§Ø¨Ù‚ **Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…ÙƒØªÙˆØ¨Ø©**ØŒ ÙˆÙ„ÙŠØ³ Ù„ÙˆÙ†Ù‡Ø§!</p>
            <div id="game4-target-word" class="text-6xl font-black my-8 p-4 rounded-lg" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">Ø£Ø­Ù…Ø±</div>
            <div id="game4-buttons" class="grid grid-cols-4 gap-4"></div>
            <button onclick="app.returnToMenu()" class="mt-8 text-gray-400">Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
        </div>

        <div id="page-game5" class="page flex-col items-center justify-center w-full max-w-2xl text-center">
             <div id="game5-setup">
                <h2 class="text-3xl font-bold mb-6">ğŸ‘¥ ØªØ³Ø¬ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø­Ø§Ø±Ø³ÙŠÙ†</h2>
                <input type="text" id="player1-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„" class="w-full p-3 mb-4 bg-gray-700 rounded-lg border border-gray-600">
                <input type="text" id="player2-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø­Ø§Ø±Ø³ Ø§Ù„Ø«Ø§Ù†ÙŠ" class="w-full p-3 mb-6 bg-gray-700 rounded-lg border border-gray-600">
                <button onclick="app.games.game5.start()" class="bg-green-500 w-full p-4 rounded-lg text-2xl font-black">ğŸ’ª Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ ğŸ’ª</button>
             </div>
             <div id="game5-play" class="hidden w-full">
                <div class="flex justify-between items-center w-full mb-4 text-2xl font-bold">
                    <div id="player1-score" class="bg-blue-600 p-3 rounded-lg">Ø§Ù„Ø­Ø§Ø±Ø³ 1: 0</div>
                    <div id="game5-round" class="text-yellow-400">Ø§Ù„Ø¬ÙˆÙ„Ø© 1 / 10</div>
                    <div id="player2-score" class="bg-red-600 p-3 rounded-lg">Ø§Ù„Ø­Ø§Ø±Ø³ 2: 0</div>
                </div>
                <p class="text-xl text-gray-400 mb-4">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙˆÙ† **Ø§Ù„Ù…Ø¹Ø§ÙƒØ³** Ù„Ù„ÙˆÙ† Ø§Ù„Ø¸Ø§Ù‡Ø± ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹!</p>
                <div id="game5-target-color" class="w-32 h-32 rounded-lg mb-6 mx-auto border-4 border-gray-600"></div>
                <div id="game5-buttons" class="grid grid-cols-4 gap-4 place-items-center"></div>
                <div id="game5-player-choice" class="hidden fixed inset-0 modal flex items-center justify-center flex-col p-4">
                    <h3 class="text-3xl font-bold mb-4">Ù…Ù† Ø§Ù„Ø°ÙŠ Ø¶ØºØ·ØŸ</h3>
                    <div class="flex gap-4">
                        <button id="p1-choice-btn" onclick="app.games.game5.selectPlayer(0)" class="text-2xl font-bold bg-blue-600 p-4 rounded-lg"></button>
                        <button id="p2-choice-btn" onclick="app.games.game5.selectPlayer(1)" class="text-2xl font-bold bg-red-600 p-4 rounded-lg"></button>
                    </div>
                </div>
             </div>
              <button onclick="app.returnToMenu()" class="mt-8 text-gray-400">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        </div>
        
        <div id="page-end-game-summary" class="modal page fixed inset-0 items-center justify-center">
            <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-md text-center border-2 border-yellow-400">
                <h2 id="summary-title" class="text-4xl font-black text-yellow-400 mb-4">Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠ!</h2>
                <p id="summary-message" class="text-xl text-gray-300 mb-6"></p>
                <div id="summary-score" class="text-6xl md:text-7xl font-black mb-6"></div>
                
                <p class="text-lg text-gray-300 my-4">Ø§Ø³ØªØ®Ø¯Ù… ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… <span class="font-bold text-yellow-400 text-2xl tracking-widest bg-gray-900 px-2 py-1 rounded">K1</span> ÙÙŠ Ù…ØªØ¬Ø±Ù†Ø§!</p>
                <a href="https://Keeper-1.com" target="_blank" class="block bg-green-500 w-full p-3 rounded-lg text-lg font-bold mb-4 hover:bg-green-600 transition">ğŸ›’ Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¢Ù†</a>
                <button id="whatsapp-share-btn" class="bg-whatsapp-green w-full p-3 rounded-lg text-lg font-bold mb-4 text-white transition">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
                <button onclick="app.submitScore()" class="bg-blue-600 w-full p-4 rounded-lg text-xl font-bold mb-4 hover:bg-blue-700 transition">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</button>
                <button onclick="app.returnToMenu()" class="bg-gray-600 w-full p-3 rounded-lg text-lg hover:bg-gray-700 transition">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                
                <div id="submission-status" class="mt-4 text-lg"></div>
            </div>
        </div>

        <div id="page-leaderboard-menu" class="page flex-col items-center justify-center w-full max-w-md text-center">
            <h2 class="text-4xl font-black mb-6">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ ğŸ†</h2>
            <div class="grid grid-cols-1 gap-4 w-full">
                <button onclick="app.showLeaderboard('game1')" class="btn-game bg-blue-600 p-4 rounded-lg text-xl font-bold">Ù„ÙˆØ­Ø© ØªØ­Ø¯ÙŠ Ø±Ø¯Ø© Ø§Ù„ÙØ¹Ù„</button>
                <button onclick="app.showLeaderboard('game2')" class="btn-game bg-green-600 p-4 rounded-lg text-xl font-bold">Ù„ÙˆØ­Ø© ØªØ­Ø¯ÙŠ Ø§Ù„Ø£ÙƒØ¨Ø± ÙˆØ§Ù„Ø£ØµØºØ±</button>
                <button onclick="app.showLeaderboard('game3')" class="btn-game bg-purple-600 p-4 rounded-lg text-xl font-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ</button>
                <button onclick="app.showLeaderboard('game4')" class="btn-game bg-red-600 p-4 rounded-lg text-xl font-bold">Ù„ÙˆØ­Ø© ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø©</button>
            </div>
             <button onclick="app.showPage('page-menu')" class="mt-8 text-gray-400">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        </div>
        
        <div id="page-leaderboard" class="page flex-col w-full max-w-4xl px-4">
             <h2 id="leaderboard-title" class="text-4xl font-black mb-4 text-center text-yellow-400">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„</h2>
             <div id="leaderboard-filters" class="flex flex-wrap justify-center gap-2 mb-4">
                <button data-period="all" onclick="app.applyLeaderboardFilter('all')" class="filter-btn active">Ø·ÙˆØ§Ù„ Ø§Ù„ÙØªØ±Ø©</button>
                <button data-period="24h" onclick="app.applyLeaderboardFilter('24h')" class="filter-btn">Ø¢Ø®Ø± 24 Ø³Ø§Ø¹Ø©</button>
                <button data-period="week" onclick="app.applyLeaderboardFilter('week')" class="filter-btn">Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹</button>
                <button data-period="month" onclick="app.applyLeaderboardFilter('month')" class="filter-btn">Ø¢Ø®Ø± Ø´Ù‡Ø±</button>
            </div>
            <div id="find-rank-section" class="mb-6 bg-gray-900 p-4 rounded-lg">
                <h3 class="text-xl font-bold mb-2 text-center">Ø§Ø¨Ø­Ø« Ø¹Ù† ØªØ±ØªÙŠØ¨Ùƒ ğŸ…</h3>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="rank-search-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³Ø¬Ù„ Ù‡Ù†Ø§..." class="flex-grow p-2 rounded-md bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                    <button onclick="app.findMyRank()" class="bg-yellow-500 text-gray-900 font-bold py-2 px-4 rounded-md hover:bg-yellow-400 transition">Ø§Ø¨Ø­Ø«</button>
                </div>
                <div id="rank-result" class="mt-3 text-lg font-semibold text-center text-yellow-300 min-h-[2.5rem]"></div>
            </div>
             <div class="w-full overflow-x-auto">
                <table class="w-full text-left bg-gray-800 rounded-lg overflow-hidden">
                    <thead><tr class="bg-gray-900 text-yellow-400"><th class="p-3">Ø§Ù„ØªØ±ØªÙŠØ¨</th><th class="p-3">Ø§Ù„Ø§Ø³Ù…</th><th class="p-3">Ø§Ù„Ù†ØªÙŠØ¬Ø©</th><th class="p-3 hidden md:table-cell">Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr></thead>
                    <tbody id="leaderboard-body"></tbody>
                </table>
             </div>
             <div id="leaderboard-loading" class="text-center p-8 text-2xl hidden">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
             <button onclick="app.showPage('page-leaderboard-menu')" class="mt-8 text-gray-400 self-center">Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>

        <div id="page-instructions" class="page flex-col w-full max-w-2xl px-4 text-center">
            <h2 class="text-4xl font-black mb-6 text-yellow-400">ğŸ“œ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</h2>
            <div class="space-y-6 text-right bg-gray-800 p-6 rounded-lg">
                <div>
                    <h3 class="text-2xl font-bold text-blue-400 mb-2">1. ØªØ­Ø¯ÙŠ Ø±Ø¯Ø© Ø§Ù„ÙØ¹Ù„ âš¡</h3>
                    <p>10 Ø¬ÙˆÙ„Ø§Øª Ø³Ø±ÙŠØ¹Ø©. ÙŠØ¸Ù‡Ø± Ù„ÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹ØŒ ÙˆØ¹Ù„ÙŠÙƒ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø¨Ù†ÙØ³ Ø§Ù„Ù„ÙˆÙ† Ø¨Ø£Ø³Ø±Ø¹ Ù…Ø§ ÙŠÙ…ÙƒÙ†. Ù„Ø¯ÙŠÙƒ 10 Ø«ÙˆØ§Ù†Ù Ù„ÙƒÙ„ Ø¬ÙˆÙ„Ø©ØŒ Ø¥Ø°Ø§ Ù„Ù… ØªØ¬Ø¨ Ø£Ùˆ Ø£Ø®Ø·Ø£ØªØŒ Ø³ØªØ­ØªØ³Ø¨ Ø¹Ù„ÙŠÙƒ Ø¹Ù‚ÙˆØ¨Ø©. Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù‡ÙŠ Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©.</p>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-green-400 mb-2">2. ØªØ­Ø¯ÙŠ Ø§Ù„Ø£ÙƒØ¨Ø± ÙˆØ§Ù„Ø£ØµØºØ± âš–ï¸</h3>
                    <p>Ù„Ø¯ÙŠÙƒ 30 Ø«Ø§Ù†ÙŠØ©. ÙÙŠ ÙƒÙ„ Ø¬ÙˆÙ„Ø© ØªØ¸Ù‡Ø± Ù„Ùƒ 6 Ø£Ø´ÙƒØ§Ù„ Ù…Ø®ØªÙ„ÙØ© Ù…Ø¹ ØªØ¹Ù„ÙŠÙ…Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© (Ø§Ø®ØªØ± Ø§Ù„Ø£ÙƒØ¨Ø±ØŒ Ø§Ù„Ø£ØµØºØ±ØŒ Ø£Ùˆ Ù„ÙˆÙ† Ù…Ø¹ÙŠÙ†). ÙƒÙ„ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ØªÙ…Ù†Ø­Ùƒ Ù†Ù‚Ø·Ø©. Ø­Ø§ÙˆÙ„ Ø¬Ù…Ø¹ Ø£ÙƒØ¨Ø± Ø¹Ø¯Ø¯ Ù…Ù† Ø§Ù„Ù†Ù‚Ø§Ø·.</p>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-purple-400 mb-2">3. Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ â±ï¸</h3>
                    <p>5 Ø¬ÙˆÙ„Ø§Øª. ÙŠØ¸Ù‡Ø± Ù„Ùƒ Ø±Ù‚Ù… Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ù…Ø«Ù„Ø§Ù‹ 5.30 Ø«Ø§Ù†ÙŠØ©). Ø¹Ù„ÙŠÙƒ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø¹Ù†Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ø¨Ø§Ù„Ø¶Ø¨Ø·. ÙƒÙ„Ù…Ø§ ÙƒÙ†Øª Ø£Ù‚Ø±Ø¨ Ù„Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ØŒ ÙƒØ§Ù†Øª Ù†ØªÙŠØ¬ØªÙƒ Ø£ÙØ¶Ù„.</p>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-red-400 mb-2">4. ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ§Ù„Ù„ÙˆÙ† ğŸ§ </h3>
                    <p>10 Ø¬ÙˆÙ„Ø§Øª. ØªØ¸Ù‡Ø± Ù„Ùƒ ÙƒÙ„Ù…Ø© Ù…Ù„ÙˆÙ†Ø© Ø¨Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù. ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªØ¬Ø§Ù‡Ù„ Ù„ÙˆÙ† Ø§Ù„ÙƒÙ„Ù…Ø© ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ù„Ø°ÙŠ ÙŠØ·Ø§Ø¨Ù‚ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…ÙƒØªÙˆØ¨Ø©. Ù†ØªÙŠØ¬ØªÙƒ ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØµØ­Ø© Ø¥Ø¬Ø§Ø¨ØªÙƒ ÙˆØ³Ø±Ø¹Ø© Ø§Ø³ØªØ¬Ø§Ø¨ØªÙƒ.</p>
                </div>
                 <div>
                    <h3 class="text-2xl font-bold text-pink-400 mb-2">5. ØªØ­Ø¯ÙŠ Ø§Ù„Ø­Ø§Ø±Ø³ÙŠÙ† ğŸ†š</h3>
                    <p>10 Ø¬ÙˆÙ„Ø§Øª Ù„Ø´Ø®ØµÙŠÙ†. ÙŠØ¸Ù‡Ø± Ù„ÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø±Ø¨Ø¹ØŒ ÙˆØ¹Ù„Ù‰ ÙƒÙ„Ø§ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…Ø¹Ø§ÙƒØ³ Ù„Ù‡ Ù…Ù† Ø¨ÙŠÙ† 8 Ø£Ù„ÙˆØ§Ù†. Ø§Ù„Ø£Ø³Ø±Ø¹ ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø·Ø©.</p>
                </div>
            </div>
            <button onclick="app.showPage('page-menu')" class="mt-8 text-gray-400">ÙÙ‡Ù…ØªØŒ Ù„Ù†Ø¨Ø¯Ø£!</button>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, push, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAVxjYN8Wt745MTnTfh9v7dF6fuJGo9lu0",
            authDomain: "k1challenge-6ccdd.firebaseapp.com",
            databaseURL: "https://k1challenge-6ccdd-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "k1challenge-6ccdd",
            storageBucket: "k1challenge-6ccdd.appspot.com",
            messagingSenderId: "872868888108",
            appId: "1:872868888108:web:0637a582e55267e4169b89",
            measurementId: "G-2PX0QX0PLZ"
        };
        
        let db;
        try {
            const firebaseApp = initializeApp(firebaseConfig);
            db = getDatabase(firebaseApp);
            await signInAnonymously(getAuth(firebaseApp));
        } catch (error) {
            console.error("Firebase initialization failed.", error);
            alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
        }

        const app = {
            pages: document.querySelectorAll('.page'),
            currentGameId: null,
            currentPlayer: {},
            currentScore: 0,
            
            showPage(pageId) {
                this.pages.forEach(p => p.classList.remove('active'));
                document.getElementById(pageId)?.classList.add('active');
            },
            prepareGame(gameId) {
                this.currentGameId = gameId;
                document.getElementById('player-name').value = localStorage.getItem('k1_player_name') || '';
                this.showPage('page-user-info');
            },
            startGame() {
                const name = document.getElementById('player-name').value.trim();
                const phone = document.getElementById('player-phone').value.trim();
                if (!name || !/^(05|5)\d{8}$/.test(phone)) {
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ ØµØ­ÙŠØ­');
                    return;
                }
                this.currentPlayer = { name, phone };
                localStorage.setItem('k1_player_name', name);
                this.showPage(`page-${this.currentGameId}`);
                this.games[this.currentGameId]?.start();
            },
            endGame(score, message, title, results = null) {
                this.currentScore = score;
                const scoreDisplayEl = document.getElementById('summary-score');
                const shareBtn = document.getElementById('whatsapp-share-btn');
                
                document.getElementById('summary-title').textContent = title || 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠ!';
                document.getElementById('summary-message').textContent = message;
                
                if (this.currentGameId === 'game1' || this.currentGameId === 'game3') {
                    scoreDisplayEl.textContent = this.formatReactionTime(score, true);
                } else {
                    scoreDisplayEl.textContent = score;
                }
                
                if (this.currentGameId === 'game1' && results) {
                    shareBtn.style.display = 'block';
                    let details = 'ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª:\n';
                    results.forEach((r, i) => {
                        details += `Ø§Ù„Ø¬ÙˆÙ„Ø© ${i + 1}: ${this.formatReactionTime(r.time)}${r.correct ? '' : ' (Ø®Ø·Ø£)'}\n`;
                    });
                    const text = `ğŸ† Ø­Ù‚Ù‚Øª Ù†ØªÙŠØ¬Ø© Ø±Ø§Ø¦Ø¹Ø© ÙÙŠ ØªØ­Ø¯ÙŠ Ø±Ø¯Ø© Ø§Ù„ÙØ¹Ù„!\n\n*Ø§Ù„Ø­Ø§Ø±Ø³:* ${this.currentPlayer.name}\n*Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:* ${this.formatReactionTime(score, true)}\n\n${details}\nØ£Øªà¸—à¹‰à¸²à¸—à¸²à¸¢Ùƒ ØªØªØºÙ„Ø¨ Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬ØªÙŠ! ğŸ’ª\n\nØ¬Ø±Ù‘Ø¨ ØªØ­Ø¯ÙŠ ÙƒÙŠØ¨Ø± ÙˆÙ† Ø¨Ù†ÙØ³Ùƒ:\n${window.location.href}`;
                    shareBtn.onclick = () => window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`, '_blank');
                } else {
                    shareBtn.style.display = 'none';
                }

                document.getElementById('submission-status').textContent = '';
                this.showPage('page-end-game-summary');
            },
            async submitScore() {
                const statusDiv = document.getElementById('submission-status');
                if (!db) { statusDiv.textContent = 'ÙØ´Ù„: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.'; return; }
                statusDiv.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
                try {
                    await push(ref(db, 'scores'), { ...this.currentPlayer, game: this.currentGameId, score: this.currentScore, timestamp: new Date().toISOString() });
                    statusDiv.textContent = 'âœ… ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!';
                } catch (error) {
                    statusDiv.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.';
                    console.error("Error saving score: ", error);
                }
            },
            returnToMenu() {
                this.games[this.currentGameId]?.clearTimers?.();
                this.currentGameId = null;
                this.showPage('page-menu');
            },
            formatReactionTime(ms, forceSeconds = false) {
                if (ms < 1000 && !forceSeconds) return `${ms} Ù….Ø«`;
                return `${(ms / 1000).toFixed(3)} Ø«Ø§Ù†ÙŠØ©`;
            },
            async showLeaderboard(gameId) {
                this.currentLeaderboardGameId = gameId;
                const gameTitles = { 'game1': 'Ù„ÙˆØ­Ø© ØªØ­Ø¯ÙŠ Ø±Ø¯Ø© Ø§Ù„ÙØ¹Ù„', 'game2': 'Ù„ÙˆØ­Ø© ØªØ­Ø¯ÙŠ Ø§Ù„Ø£ÙƒØ¨Ø± ÙˆØ§Ù„Ø£ØµØºØ±', 'game3': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ', 'game4': 'Ù„ÙˆØ­Ø© ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø©' };
                document.getElementById('leaderboard-title').textContent = gameTitles[gameId] || 'Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¨Ø·Ø§Ù„';
                this.showPage('page-leaderboard');
                document.getElementById('leaderboard-loading').classList.remove('hidden');
                document.getElementById('leaderboard-body').innerHTML = '';
                try {
                    const snapshot = await get(ref(db, 'scores'));
                    let scores = [];
                    if (snapshot.exists()) snapshot.forEach(child => { const d = child.val(); if (d.game === gameId) scores.push(d); });
                    const isReactionGame = gameId === 'game1' || gameId === 'game3';
                    const bestScores = new Map();
                    scores.forEach(s => {
                        const key = s.name.trim().toLowerCase();
                        const existing = bestScores.get(key);
                        if (!existing || (isReactionGame && s.score < existing.score) || (!isReactionGame && s.score > existing.score)) bestScores.set(key, s);
                    });
                    this.allScoresForCurrentGame = [...bestScores.values()];
                    this.applyLeaderboardFilter('all');
                } catch (error) {
                    console.error("Error fetching leaderboard: ", error);
                    document.getElementById('leaderboard-body').innerHTML = `<tr><td colspan="4" class="p-4 text-center text-red-400">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</td></tr>`;
                } finally {
                    document.getElementById('leaderboard-loading').classList.add('hidden');
                }
            },
            applyLeaderboardFilter(period) {
                document.querySelectorAll('#leaderboard-filters .filter-btn').forEach(b => b.classList.remove('active'));
                document.querySelector(`#leaderboard-filters .filter-btn[data-period='${period}']`).classList.add('active');
                let scores = [...this.allScoresForCurrentGame];
                if (period !== 'all') {
                    const now = new Date(); let cutoff = new Date();
                    if (period === '24h') cutoff.setDate(now.getDate() - 1);
                    else if (period === 'week') cutoff.setDate(now.getDate() - 7);
                    else if (period === 'month') cutoff.setMonth(now.getMonth() - 1);
                    scores = scores.filter(s => s.timestamp && new Date(s.timestamp) > cutoff);
                }
                const isReactionGame = this.currentLeaderboardGameId === 'game1' || this.currentLeaderboardGameId === 'game3';
                scores.sort((a, b) => isReactionGame ? a.score - b.score : b.score - a.score);
                const bodyEl = document.getElementById('leaderboard-body'); bodyEl.innerHTML = '';
                const top10 = scores.slice(0, 10);
                if (top10.length === 0) { bodyEl.innerHTML = `<tr><td colspan="4" class="p-4 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©.</td></tr>`; } 
                else { top10.forEach((score, i) => bodyEl.innerHTML += this.createLeaderboardRow(score, i + 1)); }
                const savedName = localStorage.getItem('k1_player_name')?.toLowerCase();
                if (savedName && !top10.some(s => s.name.toLowerCase() === savedName)) {
                    const pIndex = scores.findIndex(s => s.name.toLowerCase() === savedName);
                    if (pIndex !== -1) {
                        bodyEl.innerHTML += `<tr><td colspan="4" class="py-2"><div class="border-t-2 border-dashed border-gray-600"></div></td></tr>`;
                        bodyEl.innerHTML += this.createLeaderboardRow(scores[pIndex], pIndex + 1, true);
                    }
                }
            },
            createLeaderboardRow(score, rank, isPlayer = false) {
                let rankDisplay = rank; if (rank === 1) rankDisplay = 'ğŸ¥‡'; else if (rank === 2) rankDisplay = 'ğŸ¥ˆ'; else if (rank === 3) rankDisplay = 'ğŸ¥‰';
                const date = score.timestamp ? new Date(score.timestamp).toLocaleDateString('ar-SA') : 'N/A';
                const isReaction = this.currentLeaderboardGameId === 'game1' || this.currentLeaderboardGameId === 'game3';
                let scoreDisplay;
                if (isReaction) {
                    const seconds = (score.score / 1000).toFixed(3);
                    scoreDisplay = `<span>${seconds} Ø«Ø§Ù†ÙŠØ©</span><br><span class="text-xs text-gray-400 font-normal">(Ø³Ø±Ø¹Ø© Ø§Ø³ØªØ¬Ø§Ø¨Ø© ${score.score} Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)</span>`;
                } else {
                    scoreDisplay = `${score.score} Ù†Ù‚Ø·Ø©`;
                }
                const playerClass = isPlayer ? 'bg-blue-900/50 text-yellow-300 font-bold' : '';
                return `<tr class="border-b border-gray-700 hover:bg-gray-700 ${playerClass}"><td class="p-3 text-lg">${rankDisplay}</td><td class="p-3">${score.name}${isPlayer ? ' (Ø£Ù†Øª)' : ''}</td><td class="p-3 font-mono leading-tight">${scoreDisplay}</td><td class="p-3 hidden md:table-cell text-sm text-gray-400">${date}</td></tr>`;
            },
            findMyRank() { const name = document.getElementById('rank-search-name').value.trim(); if (!name) return; localStorage.setItem('k1_player_name', name); this.applyLeaderboardFilter(document.querySelector('#leaderboard-filters .filter-btn.active').dataset.period); },
            showFeedback(text, color) { const el = document.createElement('div'); el.textContent = text; el.className = `fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-3xl font-black p-4 rounded-lg shadow-lg z-50 feedback-animation ${color === 'green' ? 'bg-green-500/90' : 'bg-red-500/90'} text-white`; document.body.appendChild(el); setTimeout(() => el.remove(), 1500); },
            games: {
                game1: {
                    round: 0, totalRounds: 10, startTime: 0, colors: ['red', 'green', 'blue', 'yellow', 'purple', 'cyan', 'white', 'black'], results: [], timeoutId: null, roundTimeoutId: null,
                    clearTimers() { clearTimeout(this.timeoutId); clearTimeout(this.roundTimeoutId); },
                    start() { this.round = 0; this.results = []; document.getElementById('game1-results-table').innerHTML = ''; this.nextRound(); },
                    nextRound() {
                        if (++this.round > this.totalRounds) { this.end(); return; }
                        document.getElementById('game1-round').textContent = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${this.round} / ${this.totalRounds}`;
                        const targetEl = document.getElementById('game1-target-color'); targetEl.style.backgroundColor = '#1a202c';
                        document.getElementById('game1-wait-msg').style.display = 'block'; document.getElementById('game1-buttons').style.pointerEvents = 'none'; this.clearTimers();
                        this.timeoutId = setTimeout(() => {
                            const targetColor = this.colors[Math.floor(Math.random() * this.colors.length)];
                            targetEl.dataset.color = targetColor; targetEl.style.backgroundColor = targetColor;
                            document.getElementById('game1-wait-msg').style.display = 'none'; document.getElementById('game1-buttons').style.pointerEvents = 'auto'; this.startTime = Date.now();
                            this.roundTimeoutId = setTimeout(() => this.handleTimeout(), 10000);
                        }, Math.random() * 1500 + 500);
                    },
                    handleTimeout() { if (!this.startTime) return; this.startTime = 0; this.app.showFeedback('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!', 'red'); this.results.push({ time: 10000, correct: false }); this.updateResultsTable(); this.nextRound(); },
                    checkAnswer(color) {
                        if (!this.startTime) return; this.clearTimers();
                        const isCorrect = color === document.getElementById('game1-target-color').dataset.color;
                        const reactionTime = Date.now() - this.startTime; this.startTime = 0;
                        const resultTime = isCorrect ? reactionTime : 10000;
                        this.app.showFeedback(isCorrect ? this.app.formatReactionTime(reactionTime) : 'Ø®Ø·Ø£!', isCorrect ? 'green' : 'red');
                        this.results.push({ time: resultTime, correct: isCorrect });
                        this.updateResultsTable(); this.nextRound();
                    },
                    updateResultsTable() {
                        let html = `<table class="w-full text-center bg-gray-800 rounded-lg"><thead><tr class="text-yellow-400"><th class="p-2">Ø§Ù„Ø¬ÙˆÙ„Ø©</th><th class="p-2">Ø§Ù„Ù†ØªÙŠØ¬Ø©</th></tr></thead><tbody>`;
                        this.results.forEach((r, i) => { html += `<tr class="border-t border-gray-700 ${r.correct ? 'text-green-400' : 'text-red-400'}"><td class="p-2">${i+1}</td><td class="p-2 font-bold">${this.app.formatReactionTime(r.time)}${!r.correct ? ' (Ø¹Ù‚ÙˆØ¨Ø©)' : ''}</td></tr>`; });
                        document.getElementById('game1-results-table').innerHTML = html + '</tbody></table>';
                    },
                    end() { this.clearTimers(); const avgTime = this.results.length ? Math.round(this.results.reduce((sum, r) => sum + r.time, 0) / this.results.length) : 0; this.app.endGame(avgTime, `Ù…ØªÙˆØ³Ø· Ø§Ø³ØªØ¬Ø§Ø¨ØªÙƒ ${this.app.formatReactionTime(avgTime, true)} (Ø´Ø§Ù…Ù„Ø§Ù‹ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª).`, "Ù†ØªÙŠØ¬Ø© Ø±Ø¯Ø© Ø§Ù„ÙØ¹Ù„", this.results); }
                },
                game2: {
                    score: 0, timer: 30, intervalId: null, colors: ['#ef4444', '#3b82f6', '#22c55e', '#eab308', '#8b5cf6', '#0891b2', '#f97316', '#ec4899'], colorNames: { '#ef4444': 'Ø§Ù„Ø£Ø­Ù…Ø±', '#3b82f6': 'Ø§Ù„Ø£Ø²Ø±Ù‚', '#22c55e': 'Ø§Ù„Ø£Ø®Ø¶Ø±', '#eab308': 'Ø§Ù„Ø£ØµÙØ±', '#8b5cf6': 'Ø§Ù„Ø¨Ù†ÙØ³Ø¬ÙŠ', '#0891b2': 'Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ', '#f97316': 'Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ', '#ec4899': 'Ø§Ù„ÙˆØ±Ø¯ÙŠ' },
                    clearTimers() { clearInterval(this.intervalId); },
                    start() {
                        this.score = 0; this.timer = 30;
                        document.getElementById('game2-score').textContent = this.score; document.getElementById('game2-timer').textContent = this.timer; this.nextRound();
                        this.intervalId = setInterval(() => { if (--this.timer <= 0) this.end(); document.getElementById('game2-timer').textContent = this.timer; }, 1000);
                    },
                    nextRound() {
                        const container = document.getElementById('game2-shape-container'); container.innerHTML = '';
                        const types = ['size_bigger', 'size_smaller', 'color']; const type = types[Math.floor(Math.random() * types.length)];
                        let correctValue, shapes = [];
                        if (type.startsWith('size')) {
                            document.getElementById('game2-instruction').textContent = type === 'size_bigger' ? "Ø§Ø®ØªØ± Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø£ÙƒØ¨Ø± Ø­Ø¬Ù…Ø§Ù‹" : "Ø§Ø®ØªØ± Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø£ØµØºØ± Ø­Ø¬Ù…Ø§Ù‹";
                            let sizes = new Set(); while(sizes.size < 6) sizes.add(Math.floor(Math.random() * 60) + 35);
                            let sizeArr = [...sizes]; correctValue = type === 'size_bigger' ? Math.max(...sizeArr) : Math.min(...sizeArr);
                            let colorArr = [...this.colors].sort(() => 0.5 - Math.random());
                            for(let i=0; i<6; i++) shapes.push({ size: sizeArr[i], color: colorArr[i], value: sizeArr[i] });
                        } else {
                            let targetColor = this.colors[Math.floor(Math.random() * this.colors.length)]; correctValue = targetColor;
                            document.getElementById('game2-instruction').textContent = `Ø§Ø®ØªØ± Ø§Ù„Ø´ÙƒÙ„ ${this.colorNames[targetColor]}`;
                            let otherColors = this.colors.filter(c => c !== targetColor).sort(() => 0.5 - Math.random());
                            let finalColors = [targetColor, ...otherColors.slice(0, 5)].sort(() => 0.5 - Math.random());
                            for(let i=0; i<6; i++) shapes.push({ size: Math.floor(Math.random() * 60) + 35, color: finalColors[i], value: finalColors[i] });
                        }
                        shapes.forEach(s => { const shape = this.createShape(s.size, s.color); shape.onclick = () => this.checkAnswer(s.value, correctValue); container.appendChild(shape); });
                    },
                    createShape(size, color) { const el = document.createElement('div'); el.className = 'shape rounded-lg'; el.style.cssText = `width:${size}px; height:${size}px; background-color:${color};`; return el; },
                    checkAnswer(val, correctVal) { if (val === correctVal) { this.score++; this.app.showFeedback('+1 Ù†Ù‚Ø·Ø©!', 'green'); } else { this.app.showFeedback('Ø®Ø·Ø£!', 'red'); } document.getElementById('game2-score').textContent = this.score; this.nextRound(); },
                    end() { this.clearTimers(); this.app.endGame(this.score, `Ø£Ø­Ø±Ø²Øª ${this.score} Ù†Ù‚Ø·Ø© ÙÙŠ 30 Ø«Ø§Ù†ÙŠØ©!`, "Ù†ØªÙŠØ¬Ø© ØªØ­Ø¯ÙŠ Ø§Ù„Ø£ÙƒØ¨Ø± ÙˆØ§Ù„Ø£ØµØºØ±"); }
                },
                game3: {
                    round: 0, totalRounds: 5, targetTime: 0, startTime: 0, timerInterval: null, results: [],
                    clearTimers() { clearInterval(this.timerInterval); },
                    start() { this.round = 0; this.results = []; document.getElementById('game3-results-table').innerHTML = ''; this.nextRound(); },
                    nextRound() {
                        if (++this.round > this.totalRounds) { this.end(); return; }
                        document.getElementById('game3-round').textContent = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${this.round} / ${this.totalRounds}`;
                        this.targetTime = (Math.random() * 7 + 3).toFixed(2);
                        document.getElementById('game3-target-time').textContent = this.targetTime;
                        const btn = document.getElementById('game3-action-btn');
                        btn.textContent = 'â–¶ï¸ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ø¯Ø§Ø¯'; btn.className = 'w-full p-4 text-3xl font-black rounded-lg transition bg-green-500 hover:bg-green-600';
                        btn.onclick = () => this.startTimer();
                    },
                    startTimer() {
                        this.startTime = Date.now();
                        const btn = document.getElementById('game3-action-btn');
                        btn.textContent = 'â¹ï¸ Ø£ÙˆÙ‚Ù Ø§Ù„Ø¹Ø¯Ø§Ø¯!'; btn.className = 'w-full p-4 text-3xl font-black rounded-lg transition bg-red-500 hover:bg-red-600';
                        btn.onclick = () => this.stopTimer();
                        this.timerInterval = setInterval(() => { const elapsed = ((Date.now() - this.startTime) / 1000).toFixed(2); document.getElementById('game3-timer-display').textContent = elapsed; if (elapsed >= 15) this.stopTimer(); }, 10);
                    },
                    stopTimer() { this.clearTimers(); const diff = Math.abs(((Date.now() - this.startTime) / 1000) - this.targetTime); let evaluation; if (diff <= 0.05) evaluation = 'Ù…Ù…ØªØ§Ø²! ğŸ¯'; else if (diff <= 0.1) evaluation = 'Ù‚Ø±ÙŠØ¨ Ø¬Ø¯Ø§Ù‹! ğŸ”¥'; else if (diff <= 0.25) evaluation = 'Ø¬ÙŠØ¯ ğŸ‘'; else evaluation = 'Ø¨Ø¹ÙŠØ¯ âŒ'; this.results.push({ diff: (diff*1000).toFixed(0), eval: evaluation }); this.updateResultsTable(); const btn = document.getElementById('game3-action-btn'); btn.textContent = 'Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©...'; btn.onclick = () => this.nextRound(); },
                    updateResultsTable() { let html = `<table class="w-full text-center bg-gray-800 rounded-lg mt-4"><thead><tr class="text-yellow-400"><th class="p-2">Ø§Ù„Ø¬ÙˆÙ„Ø©</th><th class="p-2">Ø§Ù„ÙØ±Ù‚ (Ù….Ø«)</th><th class="p-2">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th></tr></thead><tbody>`; this.results.forEach((r, i) => { html += `<tr class="border-t border-gray-700"><td class="p-2">${i+1}</td><td class="p-2 font-mono">${r.diff}</td><td class="p-2 font-bold">${r.eval}</td></tr>`; }); document.getElementById('game3-results-table').innerHTML = html + '</tbody></table>'; },
                    end() { const avgDiff = this.results.length ? Math.round(this.results.reduce((s, r) => s + parseInt(r.diff), 0) / this.results.length) : 0; this.app.endGame(avgDiff, `Ù…ØªÙˆØ³Ø· ÙØ±Ù‚ ØªÙˆÙ‚ÙŠØª ${this.app.formatReactionTime(avgDiff, true)}.`, "Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ", this.results); }
                },
                game4: {
                    round: 0, totalRounds: 10, score: 0, startTime: 0, colors: { 'Ø£Ø­Ù…Ø±': '#ef4444', 'Ø£Ø®Ø¶Ø±': '#22c55e', 'Ø£Ø²Ø±Ù‚': '#3b82f6', 'Ø£ØµÙØ±': '#eab308', 'Ø¨Ù†ÙØ³Ø¬ÙŠ': '#8b5cf6', 'Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ': '#f97316', 'Ø³Ù…Ø§ÙˆÙŠ': '#0891b2', 'Ø£Ø³ÙˆØ¯': '#1f2937' },
                    clearTimers() {},
                    start() { this.round = 0; this.score = 0; this.updateScoreDisplay(); this.nextRound(); },
                    updateScoreDisplay() { document.getElementById('game4-score').textContent = this.score; },
                    nextRound() {
                        if (++this.round > this.totalRounds) { this.end(); return; }
                        document.getElementById('game4-round').textContent = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${this.round} / ${this.totalRounds}`;
                        const colorNames = Object.keys(this.colors); const targetWord = colorNames[Math.floor(Math.random() * colorNames.length)];
                        let displayColorName; do { displayColorName = colorNames[Math.floor(Math.random() * colorNames.length)]; } while (displayColorName === targetWord);
                        const wordEl = document.getElementById('game4-target-word'); wordEl.textContent = targetWord; wordEl.style.color = this.colors[displayColorName];
                        const buttonsEl = document.getElementById('game4-buttons'); buttonsEl.innerHTML = '';
                        colorNames.sort(() => 0.5 - Math.random()).forEach(name => { const btn = document.createElement('button'); btn.textContent = name; btn.className = "p-4 rounded-lg text-lg md:text-xl font-bold transition"; btn.style.backgroundColor = this.colors[name]; btn.style.color = ['Ø£Ø³ÙˆØ¯', 'Ø¨Ù†ÙØ³Ø¬ÙŠ', 'Ø£Ø²Ø±Ù‚'].includes(name) ? 'white' : 'black'; btn.onclick = () => this.checkAnswer(name, targetWord); buttonsEl.appendChild(btn); });
                        this.startTime = Date.now();
                    },
                    checkAnswer(selectedWord, targetWord) {
                        if (!this.startTime) return; const reactionTime = Date.now() - this.startTime; this.startTime = 0;
                        if (selectedWord === targetWord) { const points = Math.max(0, 2000 - reactionTime); this.score += Math.round(points); this.app.showFeedback(`+${Math.round(points)} Ù†Ù‚Ø·Ø©!`, 'green'); } 
                        else { this.app.showFeedback('Ø®Ø·Ø£! âŒ', 'red'); }
                        this.updateScoreDisplay(); this.nextRound();
                    },
                    end() { this.app.endGame(this.score, `Ù„Ù‚Ø¯ Ø£Ø­Ø±Ø²Øª ${this.score} Ù†Ù‚Ø·Ø©!`, "Ù†ØªÙŠØ¬Ø© ØªØ­Ø¯ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø©"); }
                },
                game5: {
                    players: [{}, {}], round: 0, totalRounds: 10,
                    opposites: { 'white': 'black', 'black': 'white', '#ef4444': '#3b82f6', '#3b82f6': '#ef4444', '#eab308': '#22c55e', '#22c55e': '#eab308', '#8b5cf6': '#0891b2', '#0891b2': '#8b5cf6' },
                    colors: ['white', 'black', '#ef4444', '#3b82f6', '#eab308', '#22c55e', '#8b5cf6', '#0891b2'],
                    clearTimers() {},
                    start() {
                        const p1 = document.getElementById('player1-name').value.trim(); const p2 = document.getElementById('player2-name').value.trim();
                        if (!p1 || !p2) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø­Ø§Ø±Ø³ÙŠÙ†"); return; }
                        this.players = [{ name: p1, score: 0 }, { name: p2, score: 0 }]; this.round = 0;
                        document.getElementById('p1-choice-btn').textContent = p1; document.getElementById('p2-choice-btn').textContent = p2;
                        document.getElementById('game5-setup').classList.add('hidden'); document.getElementById('game5-play').classList.remove('hidden');
                        this.nextRound();
                    },
                    updateScores() { document.getElementById('player1-score').textContent = `${this.players[0].name}: ${this.players[0].score}`; document.getElementById('player2-score').textContent = `${this.players[1].name}: ${this.players[1].score}`; },
                    nextRound() {
                        if (++this.round > this.totalRounds) { this.end(); return; }
                        this.updateScores();
                        document.getElementById('game5-round').textContent = `Ø§Ù„Ø¬ÙˆÙ„Ø© ${this.round} / ${this.totalRounds}`;
                        const currentColor = this.colors[Math.floor(Math.random() * this.colors.length)];
                        document.getElementById('game5-target-color').dataset.color = currentColor; document.getElementById('game5-target-color').style.backgroundColor = currentColor;
                        const buttonsEl = document.getElementById('game5-buttons'); buttonsEl.innerHTML = '';
                        this.colors.sort(() => 0.5 - Math.random()).forEach(color => { const btn = document.createElement('button'); btn.className = "w-20 h-20 rounded-lg border-2"; btn.style.backgroundColor = color; btn.style.borderColor = color === 'white' ? 'black' : 'white'; btn.onclick = () => this.checkAnswer(color); buttonsEl.appendChild(btn); });
                    },
                    checkAnswer(selectedColor) {
                        const currentColor = document.getElementById('game5-target-color').dataset.color;
                        const target = this.opposites[currentColor] || Object.keys(this.opposites).find(k => this.opposites[k] === currentColor);
                        this.isCorrect = selectedColor === target;
                        document.getElementById('game5-player-choice').classList.add('flex'); document.getElementById('game5-player-choice').classList.remove('hidden');
                    },
                    selectPlayer(playerIndex) {
                        if (this.isCorrect) { this.players[playerIndex].score++; this.app.showFeedback(`Ù†Ù‚Ø·Ø© Ù„Ù€ ${this.players[playerIndex].name}!`, 'green'); } 
                        else { this.app.showFeedback(`Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!`, 'red'); }
                        document.getElementById('game5-player-choice').classList.add('hidden'); document.getElementById('game5-player-choice').classList.remove('flex');
                        this.nextRound();
                    },
                    end() { let message; if (this.players[0].score > this.players[1].score) message = `Ø§Ù„Ø¨Ø·Ù„ Ù‡Ùˆ ${this.players[0].name} Ø¨Ù†ØªÙŠØ¬Ø© ${this.players[0].score}-${this.players[1].score}!`; else if (this.players[1].score > this.players[0].score) message = `Ø§Ù„Ø¨Ø·Ù„ Ù‡Ùˆ ${this.players[1].name} Ø¨Ù†ØªÙŠØ¬Ø© ${this.players[1].score}-${this.players[0].score}!`; else message = `ØªØ¹Ø§Ø¯Ù„ Ø¨Ù†ØªÙŠØ¬Ø© ${this.players[0].score}!`; alert(message); this.app.showPage('page-menu'); }
                }
            }
        };
        Object.values(app.games).forEach(game => game.app = app);
        window.app = app;
    </script>
</body>
</html>